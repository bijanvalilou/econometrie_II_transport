---
title: "Econometrie II : Transports"
author: "Guewen HESLAN - Bijan VALILOU"
date: "Janvier 2021"
output:
  pdf_document:
    citation_package: biblatex
    toc: no
    number_sections: yes
    toc_depth: 4
    highlight: tango
    latex_engine: lualatex
    fig_caption: yes
  html_document:
    toc: yes
    toc_depth: 5
subtitle: "Rapport"
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyfoot[CO,CE]{Econométrie II}
- \fancyfoot[LE,RO]{\thepage}
bibliography: references.bib
---

\newpage

# Introduction

```{r, include=FALSE}
library(usethis)
library(readxl)
library(gitcreds)
library(strucchange)
library(gets)
library(ggplot2)
library(kableExtra)
library(pander)
library(ggpubr)
```

```{r, include=FALSE}


Transport_France2019 <- read_excel("Transport_France2019_v2.xlsx")

##Vecteurs des séries
#Qtt_Trsp_route <- Transport_France2019$Qtt_Trsp_route
#Qtt_Trsp_train <- Transport_France2019$Qtt_Trsp_train
#Pdiesel <- Transport_France2019$Pdiesel
#Qdiesel <- Transport_France2019$QDiesel
#GDP <- Transport_France2019$GDP
#CPI <- Transport_France2019$CPI
#QDieselCamion <- Transport_France2019$Qdieselcamion

```

```{r, include=FALSE}
##Séries temporelles
Qtt_Trsp_route.ts <- ts(Transport_France2019$Qtt_Trsp_route, start=c(1985) , end=c(2019), frequency=1)
Qtt_Trsp_train.ts <- ts(Transport_France2019$Qtt_Trsp_train, start=c(1985) , end=c(2019), frequency=1)
Pdiesel.ts <- ts(Transport_France2019$Pdiesel, start=c(1985) , end=c(2019), frequency=1)
Qdiesel.ts <- ts(Transport_France2019$QDiesel, start=c(1985) , end=c(2019), frequency=1)
GDP.ts <- ts(Transport_France2019$"PIB en volume (en milliards d'euros 2014)", start=c(1985) , end=c(2019), frequency=1)
CPI.ts <- ts(Transport_France2019$CPI, start=c(1985) , end=c(2019), frequency=1)
Qdieselcamion.ts <- ts(Transport_France2019$Qdieselcamion, start=c(1985) , end=c(2019), frequency=1)

```

```{r, echo=FALSE, out.width = '10%', out.height = '10%', fig.align='center'}
kable(Transport_France2019, booktabs = T, linesep = "", caption = "Consommation de gazole des camions") %>% 
kable_styling(latex_options = "hold_position", full_width = T,font_size = 7) %>% 
row_spec(0, bold = T) %>% 
column_spec(1, width = "6cm")
```


```{r, echo=FALSE, out.width = '70%', out.height = '70%', fig.align='center'}
##Graph en niveau
plt1 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$Qtt_Trsp_route))+
labs(x = "Année", y = "Quantités transportées par route", title = "Fig. X Quantités transportées \n par route") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))


plt2 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$Qtt_Trsp_train))+
labs(x = "Année", y = "Quantités transportées par train", title = "Fig. X Quantités transportées \n par train") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))

plt3 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$Pdiesel))+
labs(x = "Année", y = "Prix du disel (euros/litre de diesel)", title = "Fig. X Prix du diesel") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))

plt4 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$"PIB en volume (en milliards d'euros 2014)"))+
labs(x = "Année", y = "PIB en volume (en milliards d'euros 2014)", title = "Fig. X Produit intérieur brut") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))


plt5 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$QDiesel))+
labs(x = "Année", y = "Quantité de diesel consommé (en milliers de tonnes)", title = "Quantité totale \n de diesel consommé") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))

plt6 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$QDiesel))+
labs(x = "Année", y = "Quantité de diesel consommé (milliers de tonnes)", title = "Quantité de diesel consommé \n par le transport par camion") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))

plt7 <- ggplot() + 
  geom_line( aes(x = Transport_France2019$Year,y = Transport_France2019$CPI))+
labs(x = "Année", y = "Indice de prix à la consommation (base 2015)", title = "Prix à la consommation") + 
    theme(axis.text=element_text(size=5),axis.title=element_text(size=6),title = element_text(size=7), plot.title = element_text(hjust = 0.5, vjust = 0.5)) +
  scale_x_continuous(breaks=seq(1985,2020,5))


figure <- ggarrange(plt1, plt2, plt3, plt4,plt5, plt6, plt7, ncol=3, nrow = 3, heights = c(1, 1))
annotate_figure(figure,
               top = text_grob("Présentation des variables", face = "bold", size = 14))


```

```{r, echo=FALSE}
n=length(Transport_France2019$Qdieselcamion)

vec <- c(Transport_France2019$Pdiesel/Transport_France2019$CPI,Transport_France2019$"PIB en volume (en milliards d'euros 2014)",Transport_France2019$Qtt_Trsp_route)
X <- matrix( vec, ncol=3) 
Y=matrix(Transport_France2019$Qdieselcamion,n,1)
q=ncol(Y);
k=ncol(X);
K=k+1

 y=Y
 x=X
 
 nobs=cbind(1:n)
 
 OLS=lm(formula = y ~ x)
 
summary(OLS) %>% pander

 kable
 names(OLS)
xc = cbind(1,x) 
bhat = OLS$coefficients 
yf = xc %*% bhat
res = y - yf
scr = t(res) %*% res


d1 = t(res) %*% res
d2 =  t(res[2:n]-res[1:n-1]) %*% (res[2:n]-res[1:n-1])
dw = d2/d1
print (dw)

```


```{r}
Wr <- efp(y ~ x, type = "Rec-CUSUM")
plot(Wr)
#
# Test Cusum Square
#
rr <- (recresid(y ~ x))
rr <- rr^2
cumrr <- cumsum(rr)/scr
#
# Valeurs seuil de la distribution Cusum
#
c0 = 0.18915

kp2=K+1
c0 = 0.18915 # valeur critique de c0

t2 <- ts(kp2:n)
t3=t2-1
smin <-((t2-k)/(n-k))-c0
smax <- ((t2-k)/(n-k))+c0
#
vec2 <- c(smin, cumrr, smax)
cusum2 <- matrix(vec2, ncol = 3); 
matplot(c(t3), cusum2, type ="l")

```

```{r}
#sctest(y ~ x, type = "Chow", point =)
# pour R, la rupture est test?e non pas sur 1979-1980 mais sur 1979. 
#Sur Eviews, la rupture est test?e sur 1980/
for(i in 9:30) {

print(sctest(y ~ x, type = "Chow", point = i) )
}

```


```{r}
n=length(Transport_France2019$Qdieselcamion)

P1 <- replicate(35, 0)
P1[1:16] <-  Transport_France2019$Pdiesel[1:16]/Transport_France2019$CPI[1:16]

P2 <- replicate(35, 0)
P2[17:35] <-  Transport_France2019$Pdiesel[17:35]/Transport_France2019$CPI[17:35]

vec <- c(P1,P2, Transport_France2019$"PIB en volume (en milliards d'euros 2014)",Transport_France2019$Qtt_Trsp_route)
X <- matrix( vec, ncol=4) 
Y=matrix(Transport_France2019$Qdieselcamion,n,1)
q=ncol(Y);
k=ncol(X);
K=k+1

 y=Y
 x=X
 
 nobs=cbind(1:n)
 
 OLS=lm(formula = y ~ x)
 
 summary(OLS)
 
 names(OLS)
xc = cbind(1,x) 
bhat = OLS$coefficients 
yf = xc %*% bhat
res = y - yf
scr = t(res) %*% res


d1 = t(res) %*% res
d2 =  t(res[2:n]-res[1:n-1]) %*% (res[2:n]-res[1:n-1])
dw = d2/d1
print (dw)

```





